<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>ビタミンD摂取チェック（週1回・研究用）</title>

<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

<style>
body{
  font-family: Arial, sans-serif;
  background:#f5f5f5;
  padding:10px;
}
h1{text-align:center;margin-bottom:0;}
h2{text-align:center;font-size:0.9em;color:#555;margin-top:5px;}

.block{
  padding:12px;
  margin-bottom:15px;
  border-radius:8px;
  box-shadow:0 2px 5px rgba(0,0,0,0.1);
}

/* ===== 背景色（ご要望対応） ===== */
.sun-block{ background:#fff8d6; }       /* 薄い黄色 */
.fish-block{ background:#eaf6ff; }      /* 薄い水色 */
.fortified-block{ background:#eef9e6; } /* 薄い黄緑 */
.supplement-block{ background:#fff1e6;} /* 薄いオレンジ */

/* ===== 入力欄 ===== */
input[type="number"],
input[type="text"],
select{
  width:100%;
  padding:8px;
  margin-bottom:8px;
  font-size:1.1em;
}

/* ===== チェックボックス・ラジオ（高齢者対応） ===== */
input[type="checkbox"],
input[type="radio"]{
  transform: scale(1.3);
  margin-right:10px;
  vertical-align:middle;
}

/* ===== ラベルと区切り線 ===== */
.block label{
  display:block;
  line-height:1.6;
  border-top:1px solid #eee;
  padding-top:6px;
  margin-top:8px;
}
.block label:first-of-type{
  border-top:none;
  padding-top:0;
  margin-top:0;
}

/* ===== ボタン ===== */
button{
  width:100%;
  padding:12px;
  font-size:1.1em;
  border:none;
  border-radius:5px;
  background:#3498db;
  color:white;
  cursor:pointer;
  min-height:48px;
}
button:hover{background:#2980b9;}

#result{
  text-align:center;
  font-size:1.4em;
  padding:10px;
}

.notice{
  font-size:0.85em;
  color:#555;
}

canvas{
  background:white;
  border-radius:8px;
}

.warning-box{
  border:1px solid #ccc;
  padding:10px;
  margin-bottom:15px;
  font-size:0.9em;
  background-color:#fff3cd;
  border-radius:8px;
}

/* ===== iPhone対策 ===== */
@media screen and (max-width:480px){
  input,select{font-size:16px;}
}
</style>
</head>

<body>

<div class="warning-box">
  <strong>【注意】</strong><br>
  本アプリの判定は、食事および日光による<br>
  体内ビタミンD供給量の合計を<br>
  理論的必要量（約15 µg／日）と比較した<br>
  参考指標です。<br><br>
  日光による生成量は、<br>
  千葉県市川市付近（北緯約35.7度）の<br>
  月平均日照条件を基に近似しています。
</div>

<h1>ビタミンD摂取チェック（週1回）</h1>
<h2>和洋女子大学 健康栄養学科 鈴木ゼミ</h2>
<p style="text-align:center;">※これは推定ツールです</p>

<p id="today" style="text-align:center;"></p>

<!-- 屋外活動 -->
<div class="block sun-block">
  <p><strong>屋外での活動（1週間平均・1日あたり）</strong></p>

  <label>朝（6:00–10:59）分／日</label>
  <input type="number" id="morning">

  <label>昼（11:00–13:59）分／日</label>
  <input type="number" id="noon">

  <label>夕（14:00–17:00）分／日</label>
  <input type="number" id="afternoon">

  <label style="font-weight:normal;">
    <input type="checkbox" id="sunblock">
    日焼け止め・日よけを使用
  </label>

  <label>日陰の割合</label>
  <select id="shade">
    <option value="1.0">日陰なし</option>
    <option value="0.75">半々</option>
    <option value="0.5">ほぼ日陰</option>
  </select>
</div>

<!-- 魚 -->
<div class="block fish-block">
  <p><strong>魚類摂取量（週あたり）</strong></p>

  <label>小鉢（30g程度）</label>
  <input type="number" id="fishSmall">

  <label>切り身（90g程度）</label>
  <input type="number" id="fishSlice">
</div>

<!-- 強化食品 -->
<div class="block fortified-block">
  <p><strong>ビタミンD強化食品（週あたり摂取回数）</strong></p>
  <input type="number" id="fortified">
</div>

<!-- サプリ -->
<div class="block supplement-block">
  <p><strong>ビタミンDサプリ（毎日）</strong></p>

  <label style="font-weight:normal;">
    <input type="radio" name="supplement" value="0" checked>
    摂取していない
  </label>
  <label style="font-weight:normal;">
    <input type="radio" name="supplement" value="10">
    10 µg／日
  </label>
  <label style="font-weight:normal;">
    <input type="radio" name="supplement" value="25">
    25 µg以上／日
  </label>
</div>

<button onclick="check()">判定する</button>

<p id="result"></p>
<canvas id="vdChart"></canvas>

<p class="notice">
※ 本結果は「1週間平均の1日当たり推定値」です。<br>
※ 季節（月）による日光効果を考慮しています。
</p>

<script>
// 日付表示
const today=new Date();
const month=today.getMonth()+1;
const date=today.getDate();
document.getElementById("today").innerText =
  "今日は "+month+"月"+date+"日 です";

// 月別UV係数（市川市近似）
const uvTable={
  1:0.26,2:0.42,3:0.57,4:0.85,5:0.98,6:1.03,
  7:1.00,8:1.23,9:0.82,10:0.52,11:0.34,12:0.22
};

// 時間帯補正
let morningFactor,noonFactor,afternoonFactor;
if(month>=6 && month<=8){
  morningFactor=0.5; noonFactor=1.0; afternoonFactor=0.5;
}else if(month==12 || month<=2){
  morningFactor=0.2; noonFactor=0.8; afternoonFactor=0.2;
}else{
  morningFactor=0.35; noonFactor=0.9; afternoonFactor=0.35;
}

function check(){
  const morning=+document.getElementById("morning").value||0;
  const noon=+document.getElementById("noon").value||0;
  const afternoon=+document.getElementById("afternoon").value||0;

  const sunblock=document.getElementById("sunblock").checked?0.2:1;
  const shade=+document.getElementById("shade").value;

  const BASE_MIN=15, BASE_VD=10;

  const sunlightVD =
    (morning*morningFactor +
     noon*noonFactor +
     afternoon*afternoonFactor)
     / BASE_MIN * BASE_VD * uvTable[month] * sunblock * shade;

  const fishVD =
    ((+document.getElementById("fishSmall").value||0)*2.5 +
     (+document.getElementById("fishSlice").value||0)*8.5) / 7;

  const fortifiedVD =
    ((+document.getElementById("fortified").value||0)*2) / 7;

  let supplementVD=0;
  document.getElementsByName("supplement").forEach(r=>{
    if(r.checked) supplementVD=+r.value;
  });

  const total=sunlightVD+fishVD+fortifiedVD+supplementVD;

  let status="充足",color="green";
  if(total<15){status="不足";color="red";}
  else if(total>100){status="過剰";color="orange";}

  document.getElementById("result").innerHTML=
    `1週間平均のビタミンD供給量：<strong>${total.toFixed(1)} µg／日</strong><br>
     判定：<span style="color:${color};font-weight:bold">${status}</span>`;

  drawChart(sunlightVD,fishVD,fortifiedVD,supplementVD);
}

function drawChart(sun,fish,fort,sup){
  const ctx=document.getElementById("vdChart");
  if(window.chart) window.chart.destroy();
  window.chart=new Chart(ctx,{
    type:"bar",
    data:{
      labels:["ビタミンD"],
      datasets:[
        {label:"日光",data:[sun],backgroundColor:"#f39c12",stack:"a"},
        {label:"魚",data:[fish],backgroundColor:"#3498db",stack:"a"},
        {label:"強化食品",data:[fort],backgroundColor:"#9b59b6",stack:"a"},
        {label:"サプリ",data:[sup],backgroundColor:"#2ecc71",stack:"a"}
      ]
    },
    options:{
      scales:{x:{stacked:true},y:{stacked:true}}
    }
  });
}
</script>

</body>
</html>
